FROM golang:1.22.7-bookworm

WORKDIR /data

ARG FRONTEND_HOST
ARG FRONTEND_PORT
ARG MINIO_HOST
ARG MINIO_PORT
ARG MINIO_ACCESS_KEY_ID
ARG MINIO_SECRET_ACCESS_KEY
ARG GIN_MODE

COPY go.mod ./
COPY go.sum ./
RUN go mod download

COPY *.go ./

RUN CGO_ENABLED=1 go build -o /fileupload

ENV FRONTEND_HOST=FRONTEND_HOST
ENV FRONTEND_PORT=FRONTEND_PORT
ENV MINIO_HOST=MINIO_HOST
ENV MINIO_PORT=MINIO_PORT
ENV MINIO_ACCESS_KEY_ID=MINIO_ACCESS_KEY_ID
ENV MINIO_SECRET_ACCESS_KEY=MINIO_SECRET_ACCESS_KEY
ENV GIN_MODE=GIN_MODE

EXPOSE 8082

CMD [ "/fileupload" ]