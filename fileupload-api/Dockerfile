FROM golang:1.22.7-bookworm

WORKDIR /data

ARG MINIO_HOST
ARG MINIO_PORT
ARG MINIO_ACCESS_KEY_ID
ARG MINIO_SECRET_ACCESS_KEY

COPY go.mod ./
COPY go.sum ./
RUN go mod download

COPY *.go ./

RUN CGO_ENABLED=1 go build -o /fileupload

ENV MINIO_HOST=MINIO_HOST
ENV MINIO_PORT=MINIO_PORT
ENV MINIO_ACCESS_KEY_ID=MINIO_ACCESS_KEY_ID
ENV MINIO_SECRET_ACCESS_KEY=MINIO_SECRET_ACCESS_KEY

EXPOSE 8082

CMD [ "/fileupload" ]
#CMD ["sleep","3600"]
